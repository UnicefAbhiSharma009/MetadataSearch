<!--
  @description       :
    Metadata Search LWC for Salesforce. Allows users to search, filter, and directly access all major metadata types (Apex, Permission Sets, Reports, Dashboards, Email Templates, Objects, Fields, etc.) from a single interface.
    Features:
      - Unified search across all supported metadata types
      - Filtering by metadata type
      - Direct links to setup/record pages
      - Table view with dynamic columns (API Version or Folder for relevant types)
      - Modern, responsive
      - Designed for extensibility and best-practice compliance
  @author            : Abhishek Sharma <absharma@unicef.org>
  @group             : Metadata Utilities
  @last modified on  : 12-29-2025
  @last modified by  : Abhishek Sharma <absharma@unicef.org>
-->
<template>
    <lightning-card class="meta-card" title="Metadata Search" icon-name="custom:custom63">
        <div class="meta-header slds-p-horizontal_medium slds-p-top_medium slds-m-bottom_medium" style="display: flex; align-items: center; gap: 16px;">
            <lightning-icon icon-name="utility:search" size="large" class="meta-header-icon"></lightning-icon>
            <div>
                <h2 class="slds-text-heading_medium">Find Salesforce Metadata</h2>
                <div class="slds-text-body_small slds-text-color_weak">Search and explore metadata in your org</div>
            </div>
        </div>
        <div class="meta-metadata-search-container">
            <div class="meta-scroll-area">
                <div class="meta-controls slds-p-horizontal_medium slds-p-bottom_none">
                    <lightning-input type="search" label="Search" value={searchTerm} onchange={handleSearchTermChange} placeholder="Type to search..." icon-name="utility:search" class="slds-m-bottom_small"></lightning-input>
                    <lightning-combobox label="Type" value={type} options={typeOptions} onchange={handleTypeChange} class="slds-m-bottom_small"></lightning-combobox>
                    <lightning-button label="Clear" onclick={handleClear} variant="neutral" class="slds-m-bottom_small"></lightning-button>
                    <div style="height: 8px;"></div>
                </div>
                <template if:true={loading}>
                    <lightning-spinner alternative-text="Loading"></lightning-spinner>
                </template>
                <template if:false={loading}>
                    <div class="meta-results slds-p-horizontal_medium">
                        <template if:true={results.length}>
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>
                                            <template if:true={showFolderColumn}>
                                                Folder
                                            </template>
                                            <template if:false={showFolderColumn}>
                                                API Version
                                            </template>
                                        </th>
                                        <th>Namespace</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={results} for:item="item">
                                        <tr key={item.id}>
                                            <td>
                                                <a href={item.recordUrl} target="_blank">{item.name}</a>
                                            </td>
                                            <td>
                                                <lightning-badge label={item.type}></lightning-badge>
                                            </td>
                                            <td>
                                                <template if:true={item.isFolderType}>
                                                    {item.folderName}
                                                </template>
                                                <template if:false={item.isFolderType}>
                                                    {item.apiVersion}
                                                </template>
                                            </td>
                                            <td>{item.namespacePrefix}</td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                        <template if:false={results.length}>
                            <div class="slds-text-color_weak slds-p-vertical_medium">No results found.</div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </lightning-card>
</template>